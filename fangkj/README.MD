# 访客机开发技术文档


## 开发过程


### 刷卡
---

可以正常操作，判断须满足如下：

- 不是已排队的访客

  刷卡的身份证id  与 队列中的身份证id 对比

刷卡操作后：

1. **来访者信息界面**

   不做操作

2. **被访者信息**

|Button|状态|
|:--|--:|
| 访客通知|Enabled|
| 快件通知|不操作|
| 扫描二维码|不操作|
| 打印二维码|Enabled|
| 110报警|不操作|


### 人脸识别
---

人脸识别时，防止被打断， 禁止任何人工操作

|Button|state|
|:--|--:|
|手工登记|disabled|
|访客通知|disabled|
|快件通知|disabled|
|扫描二维码|disabled|
|打印二维码|disabled|
|110报警|暂不操作|

人脸识别结束：1.识别成功 2.识别失败

恢复所有的按钮

|Button|state|
|:--|--:|
|手工登记|enabled|
|访客通知|enabled|
|快件通知|enabled|
|扫描二维码|enabled|
|打印二维码|enabled|
|110报警|暂不操作|

### 手工登记
---

正常可点击，需满足如下：

- 不是已排队的访客 (去除)

点击操作后：

1. **来访者信息界面**

| EditText| 状态 | 重要性|
|:--|:--|--:|
|  访客姓名 |可编写 | * |
| 性别|可选择| * |
| 身份证|可编写 | |
| 手机号|可编写 | |
| 车牌号| 可编写| |
|来访人数|可选择| * |
|来访目的|可选择| * |
| 地址|可编写|  |

|Button|状态|
|:--|--:|
|手工登记|disabled|

2. **被访者信息界面**

|Button|状态|
|:--|--:|
| 访客通知|Enabled|
| 快件通知|不操作|
| 扫描二维码|不操作|
| 打印二维码|Enabled|
| 110报警|不操作|

3. **脸部识别区域**

    打开相机，进行拍照


### 访客通知
---

访客通知可以正常发送通知，判断必须满足如下：

- "*"星号必选项数据全有

  1. 访客的姓名

  2. 性别

  3. 来访人数

  4. 来访目的

- 人脸识别成功，或者拍照成功

- 被访者信息已选择

- 不是已排队的访客(新添加)

点击操作后：

1. **来访者信息界面**

不操作

2. **被访者信息界面**

|Button|状态|
|:--|--:|
| 访客通知|Disabled|
| 快件通知|不操作|
| 扫描二维码|不操作|
| 打印二维码|Disabled|
| 110报警|不操作|

向服务器发送通知

```
url:
http://tw.twwxt.com/phone_local_visit.do
```

|key|value|
|:--|--:|
|  tc_id ||
|sex||
| visit_name||
| visit_day||
| visit_num||
| id_card||
| iphone||
| visit_pic||
| id_card_pic||
| cause||
|address||



### 打印二维码
---

**手工打印**

- "*"星号必选项数据全有

  1. 访客的姓名

  2. 性别

  3. 来访人数

  4. 来访目的

- 人脸识别成功，或者拍照成功

点击打印二维码：
1. 打印二维码 disabled

2. 给服务器发送通知

```
url:
http://tw.twwxt.com/phone_local_visit.do
```

|key|value|
|:--|--:|
|  tc_id ||
|sex||
| visit_name||
| visit_day||
| visit_num||
| id_card||
| iphone||
| visit_pic||
| id_card_pic||
| cause||
|address||

**自动打印**

- 不判断

正常打印二维码，需满足如下：

  - 访客
  - 打印机正常连接
  - 打印机纸张正常

### 扫描二维码
---
   暂不作操作

### 访客记录查询

- **时间查询**

- **姓名查询**



state

|value|注释|
|:--|:--|
|0  |待审批|
|1  |同意|
|2  |不同意|
|3  |取消|

state 为 1:同意时 进行数据展示, 其他状态不显示：

|状态|create_time|arrive_time|leave_time|
|:--|:--|:--|:--|
|预约|有|无|无|
|在访|有|有|无|
|离开|有|有|有|

排序
优先级为:
1. 预约  (时间新->旧)
2. 在访  (时间新->旧)
3. 离开  (时间新->旧)

## 预约访客登记

|key |value |
|:--|:--|
|begin_time||
|end_time||
|visit_name||
|page||
|page_size||